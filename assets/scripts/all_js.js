var app=angular.module("fbs",["ionic","ngSanitize","ngResource","ngCookies","fbs.controllers","fbs.filters","fbs.directives","fbs.services"]);app.config(function($stateProvider,$urlRouterProvider,$resourceProvider,$ionicConfigProvider){$resourceProvider.defaults.stripTrailingSlashes=!1,$ionicConfigProvider.views.maxCache(0),$urlRouterProvider.otherwise("/index"),$stateProvider.state("login",{url:"/login",views:{mainContent:{templateUrl:"pages/login.html",controller:"signCtrl"}}}).state("regist",{url:"/regist",views:{mainContent:{templateUrl:"pages/regist.html",controller:"signCtrl"}}}).state("index",{url:"/index",views:{mainContent:{templateUrl:"pages/index/index.html",controller:"indexCtrl"}}}).state("wd_list",{url:"/wd_list/:operat",views:{mainContent:{templateUrl:"pages/index/wd/wd_list.html",controller:"wendaListCtrl"}}}).state("wd_single",{url:"/wd_single/:wendaId",views:{mainContent:{templateUrl:"pages/index/wd/wd_single.html",controller:"wendaSingleCtrl"}}}).state("wd_add",{url:"/wd_add/:touserid",views:{mainContent:{templateUrl:"pages/index/wd/wd_add.html",controller:"wendaAddCtrl"}}}).state("activity_list",{url:"/activity_list/:operat",views:{mainContent:{templateUrl:"pages/index/activity/activity_list.html",controller:"activityListCtrl"}}}).state("activity_single",{url:"/activity_single/:activityId",views:{mainContent:{templateUrl:"pages/index/activity/activity_single.html",controller:"activitySingleCtrl"}}}).state("article_list",{url:"/article_list",views:{mainContent:{templateUrl:"pages/index/article/article_list.html",controller:"articleListCtrl"}}}).state("article_single",{url:"/article_single/:newsid",views:{mainContent:{templateUrl:"pages/index/article/article_single.html",controller:"articleSingleCtrl"}}}).state("licaishi_list",{url:"/licaishi_list/:operat",views:{mainContent:{templateUrl:"pages/index/licaishi/licaishi_list.html",controller:"licaishiListCtrl"}}}).state("licaishi_single",{url:"/licaishi_single/:licaishiId",views:{mainContent:{templateUrl:"pages/index/licaishi/licaishi_single.html",controller:"licaishiSingleCtrl"}}}).state("fx",{url:"/fx",views:{mainContent:{templateUrl:"pages/fx/fx.html"}}}).state("jfph",{url:"/jfph",views:{mainContent:{templateUrl:"pages/fx/jfph.html",controller:"faxianCtrl"}}}).state("lcs",{url:"/lcs",views:{mainContent:{templateUrl:"pages/fx/lcs.html",controller:"faxianCtrl"}}}).state("lcs_apply",{url:"/lcs_apply",views:{mainContent:{templateUrl:"pages/fx/lcs_apply.html",controller:"licaishiOtherCtrl"}}}).state("lcs_history",{url:"/lcs_history",views:{mainContent:{templateUrl:"pages/fx/lcs_history.html"}}}).state("xx",{url:"/xx",views:{mainContent:{templateUrl:"pages/xx/xx.html",controller:"xiaoxiCtrl"}}}).state("grzx",{url:"/grzx",views:{mainContent:{templateUrl:"pages/grzx/grzx.html",controller:"personCtrl"}}}).state("wdjf",{url:"/wdjf",views:{mainContent:{templateUrl:"pages/grzx/wdjf.html",controller:"personCtrl"}}}).state("gxzl",{url:"/gxzl",views:{mainContent:{templateUrl:"pages/grzx/gxzl.html",controller:"personCtrl"}}}).state("wjlb",{url:"/wjlb/:operat",views:{mainContent:{templateUrl:"pages/xx/wj_list.html",controller:"xiaoxiCtrl"}}}).state("wj",{url:"/wj",templateUrl:"pages/xx/wj.html"}).state("jfsc",{url:"/jfsc",views:{mainContent:{templateUrl:"pages/jfsc.html"}}}).state("pageList",{url:"/pageList",views:{mainContent:{templateUrl:"pages/pageList.html",controller:"pageListCtrl"}}})}),app.controller("appCtrl",function($scope,Tools,$rootScope){$scope.format="M/d/yy h:mm:ss a",$scope.tab=1,$scope.selectTab=function(setTab){$scope.tab=setTab},$scope.isSelected=function(checkTab){return $scope.tab===checkTab},$scope.rollback=function(){Tools.pageReturn()},$rootScope.hidefooter=!1}),angular.module("fbs.controllers",[]),angular.module("fbs.services",[]),angular.module("fbs.filters",[]),angular.module("fbs.directives",[]);;angular.module("fbs.controllers").controller("activityListCtrl",function($scope,$stateParams,$state,DataAPI){var actionsUrl,operat=$stateParams.operat;actionsUrl="my"==operat?"getmyactivitylist":"getactivitylist",$scope.details=function(activityId){$state.go("activity_single",{activityId:activityId})},$scope.activities=DataAPI.get({action:actionsUrl,pageindex:1,pagesize:10})}).controller("activitySingleCtrl",function($scope,$stateParams,$location,$ionicScrollDelegate,$sce,DataAPI){var activityId=$stateParams.activityId;$scope.activity=DataAPI.get({action:"getactivitydetail",activityid:activityId}),$scope.apply_form={show:!1},$scope.toggle_apply=function(location){$scope.apply_form.show=!$scope.apply_form.show,$scope.apply_form.show&&($location.hash(location),$ionicScrollDelegate.anchorScroll("#"+location))},$scope.SkipValidation=function(value){return $sce.trustAsHtml(value)},$scope.apply_data={activityid:activityId,action:"submitactivitysigndata"},$scope.online_apply=function(){DataAPI.get($scope.apply_data).$promise.then(function(resp){console.log(resp)})}});;angular.module("fbs.controllers").controller("articleListCtrl",function($scope,$state,DataAPI){$scope.details=function(newsid){console.log(newsid),$state.go("article_single",{newsid:newsid})},$scope.articles=DataAPI.get({action:"getnewslist",pageindex:1,pagesize:10})}).controller("articleSingleCtrl",function($scope,$stateParams,DataAPI,$sce){var articleId=$stateParams.newsid;$scope.article=DataAPI.get({action:"getnewsdetail",newsid:articleId}),$scope.SkipValidation=function(value){return $sce.trustAsHtml(value)}});;angular.module("fbs.controllers").controller("faxianCtrl",function($scope,$state,DataAPI,$sce){$scope.details=function(activityId){$state.go("activity_single",{activityId:activityId})},$scope.jfphList=DataAPI.get({action:"getscoreranklist",pagesize:10}),DataAPI.get({action:"getnewsdetail",newsid:294991}).$promise.then(function(resp){$scope.pxintro=resp,console.log(resp)}),$scope.SkipValidation=function(value){return $sce.trustAsHtml(value)},$scope.sexy=1});;angular.module("fbs.controllers").controller("indexCtrl",function($scope,$state,DataAPI,$ionicSlideBoxDelegate,$interval,Tools){$scope.sliderImgs=DataAPI.get({action:"getslide"});$interval(function(){$ionicSlideBoxDelegate.update()},1e3);$scope.msgList=DataAPI.get({action:"getindexmsglist",pageindex:1,pagesize:10}),$scope.goItem=function(url,operat){Tools.pageSkip(url,{operat:operat})}});;angular.module("fbs.controllers").controller("licaishiListCtrl",function($scope,$state,DataAPI,$stateParams){var actionsUrl,operat=$stateParams.operat;actionsUrl="myatt"==operat?"getmyattentionlist":"myfans"==operat?"getmyfanslist":"getmasterlist",$scope.lcsListReqOptions={action:actionsUrl,pageindex:1,pagesize:10,keyword:""},$scope.categoryAera=!1,$scope.ctgListReqOptions={action:"getmastertaglist",pageindex:1,pagesize:10},$scope.pageDatas={licaishiList:DataAPI.get($scope.lcsListReqOptions),categoryList:DataAPI.get($scope.ctgListReqOptions)},$scope.details=function(licaishiId){$state.go("licaishi_single",{licaishiId:licaishiId})},$scope.atteLcs=function(licaishi,$event){$event.stopPropagation&&$event.stopPropagation();var atteStatus=licaishi.isattention;atteStatus?(console.log("取消关注理财师"),DataAPI.get({action:"cancelattention",touserid:licaishi.userid}).$promise.then(function(resp){0==resp.errcode?(console.log("取消关注成功"),licaishi.isattention=!licaishi.isattention):1==resp.errcode?console.log("取消关注失败"):-1==resp.errcode?console.log("尚未登录"):2==resp.errcode&&console.log("已经关注过了")})):(console.log("关注理财师"),DataAPI.get({action:"addattention",touserid:licaishi.userid}).$promise.then(function(resp){0==resp.errcode?(console.log("关注成功"),licaishi.isattention=!licaishi.isattention):console.log(1==resp.errcode?"关注失败":"尚未登录")})),console.log(licaishi)}}).controller("licaishiSingleCtrl",function($scope,$state,$stateParams,DataAPI){var licaishiId=$stateParams.licaishiId;$scope.licaishi=DataAPI.get({action:"getmasterdetail",userid:licaishiId}),$scope.zixun=function(){$state.go("wd_add",{touserid:licaishiId})}}).controller("licaishiOtherCtrl",function($scope,DataAPI){var activityId=291504;$scope.apply_data={},$scope.apply_data.K1=1,DataAPI.get({action:"getactivitydetail",activityid:activityId}).$promise.then(function(resp){$scope.applyForm=resp,console.log($scope.applyForm.signfield)}),$scope.apply_data.activityid=activityId,$scope.apply_data.action="submitactivitysigndata",$scope.online_apply=function(){DataAPI.get($scope.apply_data).$promise.then(function(resp){console.log(resp)})}});;angular.module("fbs.controllers").controller("pageListCtrl",["$scope","$http","$state",function($scope){$scope.pageList=[{name:"首页",url:"index"},{name:"—问答",url:"wd"},{name:"——问答详情",url:"wd_single"},{name:"——创建问答",url:"wd_add"},{name:"—活动",url:"activity_list"},{name:"—文章",url:"article_list"},{name:"——文章详情",url:"article_single"},{name:"—理财师",url:"licaishi_list"},{name:"——理财师详情",url:"licaishi_single"},{name:"发现",url:"fx"},{name:"—积分排行",url:"jfph"},{name:"—优选理财师",url:"lcs"},{name:"—理财师报名",url:"lcs_apply"},{name:"—往届理财师",url:"lcs_history"},{name:"个人中心",url:"grzx"},{name:"—我的积分",url:"wdjf"},{name:"—更新资料",url:"gxzl"},{name:"消息",url:"xx"},{name:"—问卷列表",url:"wjlb"},{name:"——问卷",url:"wj"},{name:"积分商城",url:"jfsc"},{name:"登录",url:"login"},{name:"注册",url:"regist"}]}]);;angular.module("fbs.controllers").controller("personCtrl",function($scope,$state,DataAPI,$location,$cookieStore){$scope.personinf=DataAPI.get({action:"getcurrentuserinfo"}),$scope.gxzl=function(){DataAPI.get({action:"updatecurrentuserinfo",truename:$scope.personinf.truename,postion:$scope.personinf.postion,company:$scope.personinf.company}),$scope.$apply()},$scope.wdjf=DataAPI.get({action:"getscorerecordlist",pageindex:1,pagesize:10}),$scope.redir=function(url,p){$state.go(url,{operat:p},{location:!0,reload:!0})},DataAPI.get({action:"islogin"}).$promise.then(function(resp){console.log("登录检测"),console.log($cookieStore.get("ASP.NET_SessionId")),$scope.islogin=resp})});;angular.module("fbs.controllers").controller("signCtrl",function($scope,DataAPI,Tools){$scope.signInData={},$scope.signInData.action="login",$scope.signInData.userid="forbesuser1",$scope.signInData.pwd="123456",$scope.login=function(){DataAPI.get($scope.signInData).$promise.then(function(resp){console.log(resp),resp.issuccess?(Tools.pageReturn(),alert("登录成功"),alert(resp.userid)):console.log(resp.message)})},$scope.goToRegist=function(){Tools.pageSkip("regist")},$scope.registData={},$scope.registData.action="reg",$scope.registData.phone=18573619055,$scope.registData.pwd="123",$scope.registSub=function(){DataAPI.get($scope.registData).$promise.then(function(resp){0==resp.errcode?(console.log("注册成功"),Tools.pageReturn()):(console.log("注册失败"),console.log(resp.errmsg))})},$scope.reqYzw=function(){DataAPI.get({action:"getsmsvercode",phone:$scope.registData.phone}).$promise.then(function(resp){console.log(resp)})}});;angular.module("fbs.controllers").controller("wendaListCtrl",function($scope,$state,DataAPI,$stateParams){$stateParams.operat;$scope.details=function(wendaId){$state.go("wd_single",{wendaId:wendaId})},$scope.wendas=DataAPI.get({action:"getasklist",pageindex:1,pagesize:10})}).controller("wendaSingleCtrl",function($scope,$stateParams,DataAPI){var wendaId=$stateParams.wendaId;$scope.wenda=DataAPI.get({action:"getaskdetail",id:wendaId})}).controller("wendaAddCtrl",function($scope,$stateParams,DataAPI,Tools){var touserid;"none"!=$stateParams.touserid&&(touserid=$stateParams.touserid),$scope.wenda={},$scope.addWenda=function(){DataAPI.get({action:"addask",title:$scope.wenda.titles,content:$scope.wenda.content,touserid:touserid}).$promise.then(function(resp){0==resp.errcode?(console.log("话题添加成功"),Tools.pageSkip("wd_list",{operat:"all"})):1==resp.errcode&&(console.log("尚未登录"),Tools.pageSkip("login",null))})},$scope.cancelAdd=function(){console.log("取消话题添加"),Tools.pageReturn()}});;angular.module("fbs.controllers").controller("xiaoxiCtrl",function($scope,$stateParams,$state,DataAPI){var actionsUrl,operat=$stateParams.operat;actionsUrl="my"==operat?"getmyquestionnairelist":"getsystemnoticelist",$scope.wenjuanList=DataAPI.get({action:actionsUrl,noticetype:1,pageindex:1,pagesize:10}),$scope.xtxxList=DataAPI.get({action:"getsystemnoticelist",noticetype:0,pageindex:1,pagesize:10}),$scope.wdxtxx=DataAPI.get({action:"getunredsystemnoticecount",noticetype:0})});;angular.module("fbs.directives").directive("myCurrentTime",["$interval","dateFilter",function($interval){function link(scope,element,attrs){function updateTime(){element.text(start--+"s")}var format,timeoutId,start=60;scope.$watch(attrs.myCurrentTime,function(value){format=value,updateTime()}),element.on("$destroy",function(){$interval.cancel(timeoutId)}),console.log("it is start!"),timeoutId=$interval(function(){updateTime(),console.log("excu...")},1e3,60).then(function(){console.log("it is finished!")}),console.log(timeoutId)}return{link:link}}]);;angular.module("fbs.directives").directive("hideFooter",function($rootScope){return{restrict:"A",link:function(scope,element,attributes){scope.$watch(attributes.hideFooter,function(value){console.log("hidefooter = "+value),$rootScope.hideFooter=value})}}});;angular.module("fbs.directives").directive("searchByCategory",function(DataAPI){function link(scope,element){element.bind("click",function(){scope.$apply(function(){var dealDataName="licaishiList";scope.categoryAera=!1,scope.reqOptions.cateid=scope.categoryId,scope.targetDatas[dealDataName]=DataAPI.get(scope.reqOptions)})})}return{restrict:"A",scope:{categoryId:"=",reqOptions:"=",targetDatas:"=",categoryAera:"="},link:link}});;angular.module("fbs.directives").directive("searchByKeyword",function(DataAPI){function link(scope,element){element.bind("click",function(){scope.$apply(function(){scope.reqOptions.keyword=scope.keyword,scope.targetDatas.licaishiList=DataAPI.get(scope.reqOptions)})})}return{restrict:"A",scope:{keyword:"=",reqOptions:"=",targetDatas:"="},link:link}});;angular.module("fbs.filters").filter("activityStatusTextFilter",function(){return function(input){var ret;return 0==input&&(ret="进行中"),1==input&&(ret="已结束"),2==input&&(ret="满员"),ret}});;angular.module("fbs.filters").filter("lcsAttention",function(){return function(input){var ret;return input||(ret="关注"),input&&(ret="取消关注"),ret}});;angular.module("fbs.filters").filter("msgTypeFilter",function(){return function(input){var ret;return 0==input&&(ret="发表了文章"),1==input&&(ret="发表了活动"),2==input&&(ret="发表了话题"),3==input&&(ret="回答了话题"),ret}});;angular.module("fbs.services").factory("DataAPI",function($resource){var objClone=function(obj){if(null==obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=obj[attr]);return copy},baseReqUrl="http://forbes.comeoncloud.net/serv/pubapi.ashx",params={appid:"appid",appsecret:"appsecret",callback:"JSON_CALLBACK"},resource=$resource(baseReqUrl,null,{get:{method:"JSONP"}});return{get:function(subparams){var temp=objClone(params);for(var i in subparams)temp[i]=subparams[i];return resource.get(temp)}}});;angular.module("fbs.services").factory("Tools",function($state,$ionicHistory){var options={location:!0,reload:!0},pageSkip=function(url,params){$state.go(url,params,options)},pageReturn=function(){var retObj=$ionicHistory.backView();$ionicHistory.backView()?$state.go(retObj.stateName,retObj.stateParams,options):$ionicHistory.goBack()};return{pageSkip:pageSkip,pageReturn:pageReturn}});